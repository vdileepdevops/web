<div class="row">
  <div class="col-12 mt-5">
    <p class="bc-2">Loan Details</p>
  </div>
</div>
<form [formGroup]="FiLoanDetailsForm">
  <div class="row">
    <div class="col-md-8 col-xl-8">
      <div class="row ">
        <div class="col-md-6 col-xl-6 ">
          <!-- <div class="border p-2 rounded w-100">-->
          <div class="form-group">
            <label id="pDateofapplication" title="Date of application">Date of application</label>
            <fieldset [disabled]="!this.disabletransactiondate">
            <input  type="text" class="form-control"  
            formControlName="pDateofapplication" 
            placeholder="Date picker here" readonly 
              [bsConfig]="pDateOfApplicationConf" #dp="bsDatepicker"
               [bsValue]="bsValue" bsDatepicker placement="bottom" 
               (ngModelChange)="onDateChange($event)"
              [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pDateofapplication }"></fieldset>
            <div class="invalid-feedback">
              <span
                *ngIf="LoanDetailsErrorMessages.pDateofapplication">{{LoanDetailsErrorMessages?.pDateofapplication}}</span>
            </div>
          </div>
          <!-- <div class="form-group">
            <label id="pAmountrequested" title="Amount Requested">Amount Requested</label>
            <input appNumbersonly appMycurrencyFormatter maxlength="13" class="form-control" type="text"
              formControlName="pAmountrequested"
              [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pAmountrequested }">
            <div class="invalid-feedback">
              <span
                *ngIf="LoanDetailsErrorMessages.pAmountrequested">{{LoanDetailsErrorMessages?.pAmountrequested}}</span>
            </div>
          </div> -->

          <div class="form-group">
            <label title="Loan Pay-in" id="pLoanpayin">Loan Pay-in</label>
            <select (change)="changeLoanPayIn($event)" class="form-control" formControlName="pLoanpayin"
              [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pLoanpayin }">
              <option value="" disabled>Select</option>
              <option *ngFor="let type of Loanpayins" [value]="type.pLoanpayin"> {{type.pLoanpayin}}</option>
            </select>
            <div class="invalid-feedback">
              <span *ngIf="LoanDetailsErrorMessages.pLoanpayin">{{LoanDetailsErrorMessages?.pLoanpayin}}</span>
            </div>
          </div>


          <!-- </div>-->
        </div>
        <div class="col-md-6 col-xl-6 m-0">
          <!-- <div class="border p-2 rounded w-100">-->
          <div class="form-group">
            <label id="pPurposeofloan" title="Purpose of Loan">Purpose of Loan</label>
            <textarea class="form-control" maxlength="300" appCharactersonly style="height:114px !important;" placeholder="" rows="1"
              formControlName="pPurposeofloan"
              [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pPurposeofloan }"></textarea>
          </div>
          <div class="invalid-feedback">
            <span *ngIf="LoanDetailsErrorMessages.pPurposeofloan">{{LoanDetailsErrorMessages?.pPurposeofloan}}</span>
          </div>

          <!-- </div>-->
        </div>
      </div>
      <hr class="light">
      <div class="row">
        <div class="col-md-6 col-xl-6">
          <!-- <div class="border p-2 rounded w-100">-->
          <div class="form-group">
            <label title="Interest Type" id="pInteresttype">Interest Type</label>
            <!-- <select class="form-control"> -->
            <select class="form-control " formControlName="pInteresttype" (change)="onChangeInterestType($event)"
              [ngClass]="{'is-invalid':LoanDetailsErrorMessages.pInteresttype}">
              <option value="" disabled>Select</option>
              <option *ngFor="let type of LoanInterestratetypes" [value]="type.pInteresttype"> {{type.pInteresttype}}
              </option>
            </select>
            <div class="invalid-feedback">
              <span *ngIf="LoanDetailsErrorMessages.pInteresttype">{{LoanDetailsErrorMessages?.pInteresttype}}</span>
            </div>
            <!-- </select> -->
          </div>
          <!-- <div class="form-group">
              <label>Interest Rate%</label>
              <div class="input-group">
                <select class="form-control">
                  <option>7</option>
                  <option>7.5</option>
                  <option>8</option>
                  <option>8.5</option>
                  <option>9</option>
                  <option>9.5</option>
                </select>
                <div class="input-group-append"> <span class=" w-auto btn-lg-icon h-100 pt-2 pl-2 pr-2  rounded-right">
                    P.A </span> </div>
              </div>
            </div> -->


          <!-- <div class="form-group">
            <label id="pTenureofloan" title="Tenure of Loan">Tenure of Loan</label>
            <label id="pTenuretype" title="Tenure of Type" hidden></label>
            <div class="input-group w-auto">
              <input appNumbersonly maxlength="3" class="form-control" type="text" value=""
                formControlName="pTenureofloan" [ngClass]="{ 'is-invalid':  LoanDetailsErrorMessages.pTenureofloan }">
           
              <div class="invalid-feedback">
                <span *ngIf="LoanDetailsErrorMessages.pTenureofloan">{{LoanDetailsErrorMessages?.pTenureofloan}}</span>
              </div>
            </div>
          </div> -->

          <div class="form-group">
            <label id="pAmountrequested" title="Amount Requested">Amount Requested</label>
            <input appNumbersonly  removeZero  maxlength="12" class="form-control text-right" type="text"
              formControlName="pAmountrequested" (change)="onEnteredAmountValue($event)"
              [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pAmountrequested }">
            <div class="invalid-feedback">
              <span
                *ngIf="LoanDetailsErrorMessages.pAmountrequested">{{LoanDetailsErrorMessages?.pAmountrequested}}</span>
            </div>
          </div>
          <!--</div>-->
        </div>
        <div class="col-md-6 col-xl-6">
          <!--<div class="border p-2 rounded w-100">-->
          <!-- <div class="form-group">
            <label title="Loan Pay-in" id="pLoanpayin">Loan Pay-in</label>
            <select (change)="ChangeLoanPayIn($event)" class="form-control" formControlName="pLoanpayin"
              [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pLoanpayin }">
              <option value="" disabled>Select</option>
              <option *ngFor="let type of Loanpayins" [value]="type.pLoanpayin"> {{type.pLoanpayin}}</option>
            </select>
            <div class="invalid-feedback">
              <span *ngIf="LoanDetailsErrorMessages.pLoanpayin">{{LoanDetailsErrorMessages?.pLoanpayin}}</span>
            </div>
          </div> -->


          <div class="form-group">
            <label id="pTenureofloan" title="Tenure of Loan">Tenure of Loan</label>
            <label id="pTenuretype" title="Tenure of Type" hidden></label>
            <div class="input-group w-auto">
              <input appNumbersonly maxlength="3" class="form-control" type="text" value="" (change)="onTensureOfLoanChange($event)"
                formControlName="pTenureofloan" [ngClass]="{ 'is-invalid':  LoanDetailsErrorMessages.pTenureofloan }">
                <span class="for-span-text" *ngIf="FiLoanDetailsForm?.value?.pLoanpayin">{{FiLoanDetailsForm?.value?.pLoanpayin}}</span>
              <!-- <div class="input-group-append">
                <select class="form-control w-auto btn-lg-icon" formControlName="pTenuretype"
                  [ngClass]="{ 'is-invalid':  LoanDetailsErrorMessages.pTenuretype }">
                  <option value="" disabled>Select</option>
                  <option>Days</option>
                  <option>Months</option>
                  <option>Years</option>
                </select>
              </div> -->
              <div class="invalid-feedback">
                <span *ngIf="LoanDetailsErrorMessages.pTenureofloan">{{LoanDetailsErrorMessages?.pTenureofloan}}</span>
                <!-- <span *ngIf="LoanDetailsErrorMessages.pTenuretype">{{LoanDetailsErrorMessages?.pTenuretype}}</span> -->
              </div>
            </div>
          </div>

          

          <div class="form-group">
            <label id="pRateofinterest" title="Interest Rate">Interest Rate%</label>
            <div class="input-group">
              <!-- <select class="form-control">
                <option>7</option>
                <option>7.5</option>
                <option>8</option>
                <option>8.5</option>
                <option>9</option>
                <option>9.5</option>
              </select> -->
              <input id="interestRate"  appRoundecimal="2@2" class="form-control" type="text" value="" (change)="onChangeInterestRate($event)"
              formControlName="pRateofinterest" [ngClass]="{ 'is-invalid':  LoanDetailsErrorMessages.pRateofinterest }">


              <!-- <select  (change)="ChangeIntrestRate($event.target.value)" class="form-control"
                formControlName="pRateofinterest"
                [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pRateofinterest }">
                <option value="" disabled>Select</option>
                <option *ngFor="let rate of IntrestRatesList" [value]="rate.pRateofinterest"> {{rate.pRateofinterest}}
                </option>
              </select> -->
              <div class="input-group-append"> <span class=" w-auto btn-lg-icon h-100 pt-2 pl-2 pr-2  rounded-right">
                P.A </span> </div>
              <div class="invalid-feedback">
                <span
                  *ngIf="LoanDetailsErrorMessages.pRateofinterest">{{LoanDetailsErrorMessages?.pRateofinterest}}</span>
              </div>

             
            </div>
          </div>

          <!--</div>-->
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-4 order-md-first order-sm-first order-lg-last order-xl-last pt-2">
      <div class="border pt-3 pb-4 p-2 rounded w-100 mt-4 ">
        <!-- <div class="material-switch"> <span class="mr-2">Scheme</span>
          <input id="someSwitchOptionInfo" (change)="CheckScheme($event)" forControlName="pIsschemesapplicable"
            type="checkbox" />
          <label for="someSwitchOptionInfo" class="badge-success"></label>
        </div>
        <div class="input-group mt-1">
          <label id="pSchemecode" title="Scheme" hidden></label>
          <select (change)="ChangeScheme($event)" class="form-control" formControlName="pSchemecode"
            [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pSchemecode }"
            [attr.disabled]="schemedisable ? '' : null">
            <option value="" disabled>Select</option>
            <option *ngFor="let scheme of SchemeNamesList" [value]="scheme.pSchemecode"> {{scheme.pSchemename}}</option>
          </select>
          <div class="invalid-feedback">
            <span *ngIf="LoanDetailsErrorMessages.pSchemecode">{{LoanDetailsErrorMessages?.pSchemecode}}</span>
          </div>
          <div class="input-group-append">
            <a data-toggle="modal" href="#v-Modal" class="btn btn-lg-icon h-100 pt-1 pb-0"> <img
                src="assets/images/icon-more-hori-b.svg" width="20px" height="20px" class="mr-1">View</a>
          </div>
        </div> -->
        <fieldset [disabled]="schemeFlag">
          <div class="form-group">
              <div class="material-switch"><span class="mr-2">Scheme</span>
                <input id="Scheme" name="pIsschemesapplicable" type="checkbox" forControlName="pIsschemesapplicable" (change)="CheckScheme($event)" >
                <label for="Scheme" class="badge-success"></label>
              </div>
          
             <div  class="form-group " > 
                <label id="pSchemecode" title="Scheme" hidden></label>               
                 <div class="demo-section k-content"  *ngIf="schemedisable">
                     <!-- <input id="allScheme" name="Select Sales Personnel"  style="width: 100%;"  required/> -->
                     <input id="SchemeDataList" forControlName="pSchemecode" [value]="editSchemeCode" name="SchemeData" style="width: 100%;"  [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pSchemecode }"/>
                    </div>     
                    <div class="invalid-feedback-cst">
                        <span
                          *ngIf="LoanDetailsErrorMessages.pSchemecode">{{LoanDetailsErrorMessages.pSchemecode}}</span>
                      </div>       
             </div>
          </div>
          </fieldset>      
      </div>
    </div>
  </div>
  <div class="row">
    <hr class="light">
    <div class="col-md-6 col-xl-4">
      <div class="form-group">
        <label class="" id="pLoaninstalmentpaymentmode" title="Loan Installment Mode">Loan Installment Mode</label>
        <select (change)="ChangeInstallmentMode($event)" class="form-control" 
          formControlName="pLoaninstalmentpaymentmode"
          [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pLoaninstalmentpaymentmode }">
          <option value="" disabled>Select</option>
          <option *ngFor="let LoanMode of LoanInstllmentModes" [value]="LoanMode.pLoaninstalmentpaymentmodecode">
            {{LoanMode.pLoaninstalmentpaymentmode}}</option>
        </select>
        <div class="invalid-feedback">
          <span
            *ngIf="LoanDetailsErrorMessages.pLoaninstalmentpaymentmode">{{LoanDetailsErrorMessages?.pLoaninstalmentpaymentmode}}</span>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-4" *ngIf="openPartPrincipalText">
      <div class="form-group ">
        <label id="pPartprinciplepaidinterval" class="" title="Interval" for="inlineRadio1">Interval: </label>
        <div class="input-group">
          <input class="form-control" appNumbersonly maxlength="3" formControlName="pPartprinciplepaidinterval" type="text"
          [ngClass]="{ 'is-invalid':  LoanDetailsErrorMessages.pPartprinciplepaidinterval }"
          (change)="validateInterval($event)" >
          <span class="for-span-text" *ngIf="FiLoanDetailsForm?.value?.pLoanpayin">{{FiLoanDetailsForm?.value?.pLoanpayin}}</span>
          <!-- <div class="input-group-append">
            <select class="form-control w-auto btn-lg-icon">
              <option>Days</option>
              <option>Months</option>
              <option>Years</option>
            </select>
          </div> -->
        </div>
        <div class="invalid-feedback-cst">
          <span
            *ngIf="LoanDetailsErrorMessages?.pPartprinciplepaidinterval">{{LoanDetailsErrorMessages?.pPartprinciplepaidinterval}}</span>
        </div> 
      </div>
    </div>
    <hr>
    <div class="col-md-6 col-xl-4">
      <div class="from-group mt-4 mb-4" *ngIf="!hideCalculateEmiButton"> 
        <a data-toggle="modal" href="#v-Modal" class="btn btn-b-icon px-3 border-0"
        data-toggle="modal" tabindex="-1" data-target="#emiModal" (click)="getFiEmiSchesuleview()">
          <img src="assets/images/icon-add-white.svg" width="20px" height="20px" class="mr-3">calculate EMI</a> 
        </div>
      <div class="form-group">
        <label id="pInstalmentamount" title="Loan Installment">Loan Installment </label>
        <input appNumbersonly maxlength="15"  [value]="installmentAmount"  class="form-control w-auto border-warning sec-head-bold " type="text" placeholder=""
          [ngClass]="{ 'is-invalid': LoanDetailsErrorMessages.pInstalmentamount }" formControlName="pInstalmentamount" disabled>
        <div class="invalid-feedback">
          <span
            *ngIf="LoanDetailsErrorMessages.pInstalmentamount">{{LoanDetailsErrorMessages?.pInstalmentamount}}</span>
        </div>
      </div>
    </div>
  </div>
</form>
<div class="d-flex justify-content-end mt-4"> 
  <a  *ngIf="forClearButton" class="btn btn-g-icon mr-4 px-3 border-0 cursor-pointer" (click)="clearForm()" ><img
      src="assets/images/icon-cancel-white.svg" width="20px" height="20px" class="mr-3" 
      />Clear</a>

      <a  data-toggle="tab" class="btn btn-g-icon px-3 border-0 mr-4 cursor-pointer" role="tab"
       aria-controls="hot"  (click)="moveToPreviousTab()"
          aria-selected="false"><img src="assets/images/icon-chewron-left-whitesolid.svg" 
          width="20px" height="20px"
            class="mr-3" >Back</a>
              <!-- <a
    (click)="nextButtonClick()" data-toggle="tab" class="btn btn-b-icon px-3 border-0" role="tab" aria-controls="hot"
    aria-selected="false"><img src="assets/images/icon-chewron-right-whitesolid.svg" width="20px" height="20px"
      class="mr-3" />Save & Continue</a>  -->

      <button (click)="nextButtonClick()" data-toggle="tab" class="btn btn-b-icon px-3 border-0" role="tab"
            aria-controls="hot" aria-selected="false" [disabled]="isLoading">
            <i class="fa" [ngClass]="{'fa-spin fa-spinner': isLoading,'fa-check': !isLoading}"></i>
            <span *ngIf="!isLoading">
            </span>{{buttonName}}</button>

    </div>



      <div class="modal right 	modal-xl slideInRight" *ngIf="emiFlag" id="emiModal" tabindex="-1" role="dialog">
        <div class="customModal" style="margin-right:0px !important; ">
          <div class="model-cst modal-content">
      
            <div class="modal-body">
              <p class="bc-2">Installment Chart</p>
      
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <div class="row mt-4">
                <div class="col-md-12 col-xl-12">
                  <!-- <kendo-grid [data]="gridView" [resizable]="true" [pageSize]="10" [skip]="skip" [height]="480"
                  [pageable]="true" [sortable]="true" [resizable]="true"> -->
                  <kendo-grid [kendoGridBinding]="gridView" [kendoGridSelectBy]="'id'"   [height]="480"
                   [resizable]="true"  [skip]="skip"
                  [reorderable]="true" [height]="480"   [pageable]="false"
                  [sortable]="false">

                    <kendo-grid-column field="pInstalmentno" title="S.No." 
                    [style]="{'text-align': 'center'}" [footerStyle]="{'text-align': 'center'}"  width="60">
                        <ng-template style="text-align: center;" kendoGridFooterTemplate>
                            {{total}}
                          </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column field="pInstalmentprinciple" title="Principle" 
                    [headerClass]="{'kendo-right': true}" class="kendo-right" [footerClass]="{'kendo-right': true}"
                    [style]="{'text-align': 'center'}" [footerStyle]="{'text-align': 'center','padding-left':'20px'}" width="100">
                        <ng-template  kendoGridFooterTemplate>
                          <p class="bc-2 text-right">{{emiAggregates.pInstalmentprinciple | mycurrencypipe}}</p>
                          </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column field="pInstalmentinterest" title="Interest" 
                    [headerClass]="{'kendo-right': true}" class="kendo-right" [footerClass]="{'kendo-right': true}"
                    [style]="{'text-align': 'center'}" [footerStyle]="{'text-align': 'center','padding-left':'20px'}" width="100">
                        <ng-template kendoGridFooterTemplate>
                          <p class="bc-2 text-right">{{emiAggregates.pInstalmentinterest | mycurrencypipe}}</p>
                          </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column field="pInstalmentamount" title="Installment" 
                    [headerClass]="{'kendo-right': true}" class="kendo-right" [footerClass]="{'kendo-right': true}"
                    [style]="{'text-align': 'center'}" [footerStyle]="{'text-align': 'center','padding-left':'30px'}" width="160">
                        <ng-template kendoGridFooterTemplate>
                          <p class="bc-2 text-right">{{emiAggregates.pInstalmentamount | mycurrencypipe}}</p>
                          </ng-template>
                    </kendo-grid-column>          
                  </kendo-grid>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="my-container">
        <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '3px' }" [template]="customLoadingTemplateForFiView">
        </ngx-loading>
      
      </div>